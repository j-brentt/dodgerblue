{% extends "base.html" %}
{% block title %}{{ profile_author.display_name }} Â· Profile{% endblock %}
{% block content %}
<div class="card profile-card">
    <div class="profile-header">
        {% if profile_author.profile_image %}
        <img src="{{ profile_author.profile_image }}" alt="{{ profile_author.display_name }}'s profile image" class="profile-avatar">
        {% else %}
        <div class="profile-avatar placeholder">
            {{ profile_author.display_name|first|upper }}
        </div>
        {% endif %}
        <div class="profile-meta">
            <h1>{{ profile_author.display_name }}</h1>
            <p class="profile-username">@{{ profile_author.username }}</p>
            {% if profile_author.github %}
            <p class="profile-link">
                <a href="{{ profile_author.github }}" target="_blank" rel="noopener noreferrer">GitHub</a>
            </p>
            {% endif %}
            <div class="profile-counts">
                <span><strong>{{ followers_count }}</strong> Followers</span>
                <span><strong>{{ following_count }}</strong> Following</span>
            </div>
            {% if request.user.is_authenticated and request.user != profile_author %}
            <div class="follow-actions">
                {% if follow_relationship %}
                    {% if follow_relationship.status == "APPROVED" %}
                    <span class="follow-state approved">You follow {{ profile_author.display_name }}.</span>
                    {% elif follow_relationship.status == "PENDING" %}
                    <span class="follow-state pending">Follow request pending approval.</span>
                    {% elif follow_relationship.status == "REJECTED" %}
                    <form method="post" action="{% url 'authors:send_follow_request' profile_author.id %}">
                        {% csrf_token %}
                        <button type="submit" class="follow-button">Request to follow again</button>
                    </form>
                    <p class="follow-state denied">Your previous request was denied.</p>
                    {% endif %}
                {% else %}
                <form method="post" action="{% url 'authors:send_follow_request' profile_author.id %}">
                    {% csrf_token %}
                    <button type="submit" class="follow-button">Follow</button>
                </form>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <div class="profile-section">
        <h2>Public Entries</h2>
        {% if entries %}
        <ul class="entry-list">
            {% for entry in entries %}
            <li class="entry-item">
                <h3>{{ entry.title }}</h3>
                {% if entry.description %}
                <p class="entry-description">{{ entry.description }}</p>
                {% endif %}
                <p class="entry-date">{{ entry.published|date:"F j, Y" }}</p>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>This author has not published any public entries yet.</p>
        {% endif %}
    </div>
</div>

<div class="profile-actions">
    <a href="{{ return_url }}" class="return-button">Return</a>
</div>

<style>
    .profile-card {
        display: flex;
        flex-direction: column;
        gap: 30px;
    }
    .profile-header {
        display: flex;
        gap: 20px;
        align-items: center;
    }
    .profile-avatar {
        width: 96px;
        height: 96px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #1E90FF;
    }
    .profile-avatar.placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #1E90FF;
        color: #fff;
        font-size: 36px;
        font-weight: 600;
    }
    .profile-meta h1 {
        margin-bottom: 8px;
    }
    .profile-username {
        color: #666;
    }
    .profile-link a {
        color: #1E90FF;
        text-decoration: none;
    }
    .profile-section h2 {
        margin-bottom: 12px;
    }
    .entry-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    .entry-item h3 {
        margin-bottom: 6px;
        color: #1E90FF;
    }
    .entry-description {
        color: #555;
        margin-bottom: 6px;
    }
    .entry-date {
        font-size: 14px;
        color: #888;
    }
    .profile-counts {
        display: flex;
        gap: 16px;
        margin-top: 8px;
        font-size: 14px;
        color: #444;
    }
    .follow-actions {
        margin-top: 16px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .follow-button {
        padding: 8px 16px;
        background-color: #1E90FF;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
    }
    .follow-button:hover {
        background-color: #187bcd;
    }
    .follow-state {
        font-size: 14px;
    }
    .follow-state.approved {
        color: #2e7d32;
    }
    .follow-state.pending {
        color: #ef6c00;
    }
    .follow-state.denied {
        color: #c62828;
    }
    .profile-actions {
        margin-top: 20px;
        text-align: center;
    }
    .return-button {
        display: inline-block;
        padding: 10px 24px;
        background-color: #1E90FF;
        color: #fff;
        text-decoration: none;
        border-radius: 4px;
        font-weight: 500;
    }
    .return-button:hover {
        background-color: #187bcd;
    }
</style>
{% endblock %}
